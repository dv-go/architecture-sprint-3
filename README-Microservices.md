# Микросервисное приложение Smart-Home для управления устройствами умного дома 

## Описание проекта
Это приложение реализует микросервисную архитектуру для управления устройствами в умном доме. Система включает в себя два микросервиса: "Управление устройствами" и "Телеметрия".

## Декомпозиция на микросервисы
Система разбита на следующие микросервисы:

- **Управление устройствами (device-management)**:
  - Отвечает за управление системой отопления в домах, включая функции включения/выключения, установку желаемой температуры и мониторинг состояния.
  - Обеспечивает возможность легко добавлять новые функции управления умным домом, такие как управление освещением, воротами и другими устройствами.

- **Телеметрия (telemetry)**:
  - Собиратель данных о состоянии устройств и окружающей среде, таких как температура, влажность и другие параметры.
  - Позволяет пользователям просматривать данные о состоянии устройств в реальном времени.

В качестве имитации датчика создан сервис **Sensor**, который каждую секунду отправляет телеметрические данные в сервис "Телеметрия"

## Определение взаимодействия
### Взаимодействие между микросервисами
- Микросервисы общается друг с другом синхронно через RESTful API. Сервис "Управление устройствами" каждые 5 секунд отправляет запрос в сервис "Телеметрия" и получает текущие данные датчиков. Сервис "Телеметрия" каждую секунду получает данные телеметрии с датчика Sensor.
- API Gateway Kong управляет маршрутизацией запросов к микросервисам.

### Взаимодействие с базой данных
- Каждый микросервис имеет свою собственную базу данных PostgreSQL, что позволяет изолировать данные и упрощает масштабируемость.

## Визуализация архитектуры

### C4 — Уровень контекста (Context)

Ссылка на диаграмму контекста: [ToBeContextDiagram.puml](./2.%20ToBeContextDiagram.puml)

### C4 — Уровень контейнеров (Containers)
Ссылка на диаграмму контейнеров: [DeviceManagementContainerDiagram](./3.%20DeviceManagementContainerDiagram.puml)

### C4 — Уровень компонентов (Components)
Ссылка на диаграмму для микросервиса "Управление устройствами" (компонентов): [DeviceManagementComponentDiagram.puml](./4.%20DeviceManagementComponentDiagram.puml)

Ссылка на диаграмму для микросервиса "Телеметрия" (компонентов): [TelemetryComponentDiagram.puml](./5.%20TelemetryComponentDiagram.puml)

### C4 — Уровень кода (Code)
Ссылка на диаграмму кода микросервиса "Управление устройствами"": [DeviceManagementCodeDiagram.puml](./6.%20DeviceManagementCodeDiagram.puml)

Ссылка на диаграмму кода микросервиса "Телеметрия": [TelemetryCodeDiagram.puml](./7.%20TelemetryCodeDiagram.puml)

### ER Модель
Также была разработана ER модель для визуализации структуры базы данных. Ссылка на ER диаграмму: [ER-diagram.puml](./ER-diagram.puml)

## Запуск

### Сборка артефактов с использованием Maven
```bash
cd ./device-management
mvn clean package
```
```bash
cd ../telemetry
mvn clean package
```
```bash
cd ../sensor
mvn clean package
```
### Запуск системы через Docker Compose (образы будут собраны автоматически)
```bash
cd .. 
docker-compose up --build
```

### Остановка системы
```bash
docker-compose down
```

## Маршрутизация

### Доступ к API Gateway Kong:
```bash
http://localhost:8000/
```
### Микросервис "Управление устройствами":
```bash
http://localhost:8000/device-management/
```
### Микросервис "Телеметрия":
```bash
http://localhost:8000/telemetry/
```

## Интерфейсы Swagger

### Интерфейс Swagger Управление устройстсвами
```bash
http://localhost:8000/device-management/swagger-ui/index.html
```
### Интерфейс Swagger Телеметрия 
```bash
http://localhost:8000/telemetry/swagger-ui/index.html
```

## Заключение
В результате выполнения задания:
- Система была успешно разбита на два микросервиса: "Управление устройствами" и "Телеметрия".
- Определено взаимодействие между микросервисами, API Gateway и базой данных.
- Созданы C4 диаграммы на уровне контейнеров и компонентов, визуализирующие архитектуру системы.
- При необходимости созданы C4 диаграммы на уровне кода для самых критичных частей системы.Все диаграммы созданы с использованием PlantUML и соответствуют стандартам C4.
- Разработана ER модель для базы данных.
- Каждый микросервис имеет API интерфейс по стандарту OpenAPI.